<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- Fixed viewport so that mobile devices render a desktop (PC-like) view -->
<meta name="viewport" content="width=device-width, initial-scale=1">
  <title> CCS </title>
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">

  <link rel="icon" type="image/png" href="assets/icons/favicon.png">



<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#012169">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <style>
    /* ========================================================
       CSS Variables for Themes & Global Settings
    ======================================================== */
    :root {
      --gold: #d4af37;
      --deep-blue: #012169;
      --white: #fff;
      --dark-bg: #000;
      --overlay-bg: rgba(0, 0, 0, 0.55);
      --container-bg: rgba(0, 0, 0, 0.85);
      --font-family: 'Cinzel', serif;
      /* Alternate Mode Colors */
      --alt-bg: #0a0a23;
      --alt-text: var(--gold);
      --alt-container-bg: rgba(10, 10, 35, 0.9);
    }
    
    /* ========================================================
       Global Reset & Base Styles
    ======================================================== */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: var(--font-family);
      background: var(--dark-bg);
      color: var(--white);
      overflow-x: auto;
      scroll-behavior: smooth;
      transition: background 0.5s ease, color 0.5s ease;
      position: relative;
    }
    /* Enhanced Star Mode styling */
    body.alternate-mode {
      background: var(--alt-bg);
      color: var(--alt-text);
    }
    body.alternate-mode::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      /* Replace the URL below with your own star field image if desired */
      background: url('assets/images/starfield.jpg') no-repeat center center fixed;
      background-size: cover;
      opacity: 0.2;
      pointer-events: none;
      z-index: -20;
      animation: twinkle 10s infinite alternate;
    }
    @keyframes twinkle {
      0% { opacity: 0.2; }
      50% { opacity: 0.3; }
      100% { opacity: 0.2; }
    }
    body.alternate-mode .container {
      background: var(--alt-container-bg);
      border-color: var(--gold);
      box-shadow: 0 0 40px rgba(1,33,105,0.7);
    }
    body.alternate-mode button {
      background: var(--alt-bg);
      color: var(--alt-text);
      border-color: var(--gold);
    }
    body.alternate-mode button:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(1,33,105,0.7);
    }
    
    /* ========================================================
       Scrollbar Styling
    ======================================================== */
    ::-webkit-scrollbar { width: 12px; }
    ::-webkit-scrollbar-thumb {
      background: #333; border-radius: 6px; border: 2px solid #000;
    }
    ::-webkit-scrollbar-thumb:hover { background: #555; }
    
    /* ========================================================
       Fullscreen Background Video & Overlay
    ======================================================== */
    #bgVideo {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      object-fit: cover; z-index: -10;
    }
    #videoOverlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: linear-gradient(180deg, rgba(0,0,0,0.75) 0%, rgba(0,0,0,0.5) 50%, rgba(0,0,0,0.75) 100%);
      z-index: -5;
    }
    

/* Minimum touch target size */
button, .icon-option, .team-block {
    min-width: 48px;
    min-height: 48px;
}

/* Disable text selection */
body {
    -webkit-user-select: none;
    user-select: none;
}

/* Tap highlight color */
* {
    -webkit-tap-highlight-color: rgba(212, 175, 55, 0.3);
}




/* Mobile Responsive Adjustments */
@media (max-width: 768px) {
    .container, #league {
        width: 95% !important;
        margin: 20px auto !important;
        padding: 15px !important;
    }

    h1 {
        font-size: 2em !important;
    }

    .team-input input[type="text"] {
        width: 80% !important;
    }

    #muteBtn, #themeToggle {
        font-size: 1.2em !important;
        padding: 8px !important;
        top: 10px !important;
    }

    #muteBtn { right: 80px !important; }

.icon-bar {
  display: flex;
  flex-wrap: wrap; /* Icons wrap to new rows on narrow screens */
  justify-content: center; /* Center icons in each row */
  gap: 10px; /* Space between icons */
  padding: 10px; /* Padding around the bar */
  /* Removed overflow-x: auto since wrapping handles overflow */
}

.icon-option {
  width: 44px; /* Minimum touch target size */
  height: 44px;
  /* Retain other styles like background, cursor, etc. */
}

    .match {
        margin: 10px 0 !important;
        padding: 10px !important;
    }

    button {
        padding: 10px 15px !important;
        font-size: 1em !important;
    }
}

/* Prevent horizontal scroll on mobile */
html, body {
    overflow-x: hidden;
    max-width: 100%;
}

/* Adjustments for screens up to 768px (tablets and smaller) */
@media (max-width: 768px) {
  #bracket, #championBracket {
    flex-direction: column;
    align-items: center;
    gap: 20px;
  }
  .bracket-round {
    width: 100%;
    max-width: 300px;
    min-width: 0;
  }
  .connectors {
    display: none;
  }
}

    /* Stack manual pairing bucket vertically */
    #pairingBucket {
        flex-direction: column;
        gap: 10px;
    }
    .dropZone {
        width: 100%;
        max-width: 300px;
        height: 100px;
    }

    /* Optimize league schedule rounds */
    #leagueSchedule .bracket-round {
        min-width: 200px; /* Reduce width for smaller screens */
        flex: 0 0 200px;
    }

    /* Enhance button sizes for touch */
    button {
        padding: 12px 18px !important;
        font-size: 1.1em !important;
    }

    /* Adjust team blocks for better spacing */
    .team-block {
        padding: 8px;
    }
}

/* Adjustments for very small screens (e.g., phones below 480px) */
@media (max-width: 480px) {
    /* Stack mute and theme toggle buttons vertically */
    #muteBtn {
        right: 20px !important;
        top: 60px !important;
    }
    #themeToggle {
        right: 20px !important;
        top: 10px !important;
    }

    /* Further reduce sizes for readability */
    h1 {
        font-size: 1.8em !important;
    }
    .team-input input[type="text"] {
        width: 70% !important;
    }
    .icon-option {
        width: 24px !important;
        height: 24px !important;
    }
}

@media (max-width: 768px) {
    #bracket, #championBracket {
        flex-direction: column;
        align-items: center;
        gap: 20px;
    }
    .bracket-round {
        width: 100%;
        max-width: 300px;
        min-width: 0;
    }
    .connectors {
        display: none;
    }
    #pairingBucket {
        flex-direction: column;
        gap: 10px;
    }
    .dropZone {
        width: 100%;
        max-width: 300px;
        height: 100px;
    }
    #leagueSchedule .bracket-round {
        min-width: 200px;
        flex: 0 0 200px;
    }
    button {
        padding: 12px 18px !important;
        font-size: 1.1em !important;
    }
    .team-block {
        padding: 8px;
    }
}

@media (max-width: 480px) {
    #muteBtn {
        right: 20px !important;
        top: 60px !important;
    }
    #themeToggle {
        right: 20px !important;
        top: 10px !important;
    }
    h1 {
        font-size: 1.8em !important;
    }
    .team-input input[type="text"] {
        width: 70% !important;
    }
    .icon-option {
        width: 24px !important;
        height: 24px !important;
    }
}

.league-result-btn.small {
    font-size: 0.8em;
    padding: 4px 6px;
}



@media (max-width: 768px) {
  .team-input {
    flex-direction: column; /* Stack name input, file input, and icon bar vertically */
    align-items: center; /* Center elements */
  }
  .icon-bar {
    justify-content: center; /* Ensure wrapped icons are centered */
  }
}

@media (max-width: 768px) {
  .team-input {
    flex-direction: column; /* Stack name input, file input, and icon bar vertically */
    align-items: center; /* Center elements */
  }
  .icon-bar {
    justify-content: center; /* Ensure wrapped icons are centered */
  }
}







@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');


/* Premier League-Inspired League Mode Theme */
.league-theme {
  font-family: 'Montserrat', sans-serif;
  background-color: #ffffff; /* Clean white background for the overall page */
  color: #00295B; /* Dark navy text */
}

/* Fullscreen Background Container */
.league-theme #bgImage {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-position: center center;
  background-size: cover;
  filter: brightness(0.95);
  z-index: -9999;
}


.league-theme #leagueTable {
  background: rgba(255, 255, 255, 0.95); /* Almost solid white */
  border: 1px solid #E21A22;  /* Optional: add a red border for extra punch */
  padding: 20px;
  border-radius: 4px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
}




/* Transparent, Premium Containers */
.league-theme .container {
  background: rgba(255, 255, 255, 0.9); /* Slightly transparent white */
  border: 1px solid #E21A22;           /* Bold red border */
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  padding: 30px;
  border-radius: 4px;
  margin: 20px auto;
  max-width: 1200px;
}

/* Headings: Bold, Uppercase Red */
.league-theme h1,
.league-theme h2,
.league-theme h3 {
  color: #E21A22;        /* Bright red */
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 15px;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
}

/* Buttons: Clean Red with Modern Hover */
.league-theme button {
  background: #E21A22;
  border: none;
  color: #fff;
  padding: 10px 20px;
  border-radius: 2px;
  text-transform: uppercase;
  font-weight: bold;
  letter-spacing: 0.5px;
  cursor: pointer;
  transition: background 0.3s ease, transform 0.3s ease;
}
.league-theme button:hover {
  background: #C2181D;
  transform: translateY(-2px);
}

/* Form Elements: Clean, With Navy Borders */
.league-theme input[type="text"],
.league-theme input[type="number"],
.league-theme select,
.league-theme textarea {
  background: #fff;
  border: 1px solid #00295B;
  padding: 10px;
  border-radius: 2px;
  font-size: 1rem;
  color: #00295B;
  margin-bottom: 15px;
}

/* Links: Red with Underline on Hover */
.league-theme a {
  color: #E21A22;
  text-decoration: none;
  border-bottom: 1px solid #00295B;
}
.league-theme a:hover {
  color: #00295B;
  border-bottom: 1px solid #E21A22;
}

/* Tournament Name Section Input (if applicable) */
.league-theme #tournamentNameSection input {
  background: rgba(255, 255, 255, 0.9);
  border: 2px solid #00295B;
  padding: 10px;
  border-radius: 4px;
  font-size: 1rem;
  color: #00295B;
}

/* Global Leaderboard Section */
.league-theme #persistentLeaderboardContent {
  background: rgba(255, 255, 255, 0.9);
  border: 1px solid #E21A22;
  padding: 15px;
  border-radius: 4px;
}


.league-theme #leagueLeaderboard {
  background: rgba(255, 255, 255, 0.95); /* Nearly solid white */
  border: 1px solid #E21A22;  /* Bold red border for contrast */
  padding: 20px;
  border-radius: 4px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
}







/* Champion League Theme */
.champion-theme {
  font-family: 'Cinzel', serif;  /* Already imported in your head */
  background-color: #012169;       /* Deep blue */
  color: #d4af37;                /* Gold for text */
}

/* Headings: Bold, uppercase gold with subtle shadow */
.champion-theme h1,
.champion-theme h2,
.champion-theme h3 {
  color: #d4af37;
  text-transform: uppercase;
  letter-spacing: 1px;
  text-shadow: 1px 1px 2px #000;
  margin-bottom: 10px;
}

/* Buttons: Deep blue background, gold border and text */
.champion-theme button {
  background-color: #012169;
  border: 2px solid #d4af37;
  border-radius: 4px;
  color: #d4af37;
  padding: 12px 20px;
  text-transform: uppercase;
  font-weight: bold;
  transition: background 0.3s ease, transform 0.3s ease;
  cursor: pointer;
}
.champion-theme button:hover {
  background-color: #001c3b;
  transform: scale(1.05);
}

/* Containers: Semi-transparent deep blue with a gold border */
.champion-theme .container {
  background: rgba(1,33,105,0.85);
  border: 4px solid #d4af37;
  box-shadow: 0 0 40px rgba(1,33,105,0.7);
  padding: 40px;
  border-radius: 12px;
  margin-bottom: 20px;
}

/* Input Fields: Dark blue background with gold borders */
.champion-theme input[type="text"],
.champion-theme input[type="number"],
.champion-theme select,
.champion-theme textarea {
  background-color: #001f3f;
  border: 2px solid #d4af37;
  padding: 10px;
  border-radius: 4px;
  color: #d4af37;
}

/* Links: Gold text with subtle underline */
.champion-theme a {
  color: #d4af37;
  text-decoration: none;
  border-bottom: 1px solid #d4af37;
}
.champion-theme a:hover {
  color: #f5c842;
  border-bottom: 1px solid #f5c842;
}

/* Background Container: Adjust brightness if needed */
.champion-theme #bgImage {
  filter: brightness(1);
}


/* Champion League Bracket Redesign */
.champion-theme #bracket {
  display: flex;
  flex-direction: row;
  justify-content: center;
  gap: 30px;
  padding: 20px;
}

.champion-theme .bracket-round {
  background: rgba(1,33,105,0.85);  /* Deep blue, slightly transparent */
  border: 2px solid #d4af37;          /* Gold border */
  border-radius: 10px;
  padding: 20px;
  min-width: 220px;
  position: relative;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
}

.champion-theme .bracket-round h3 {
  margin-bottom: 15px;
  color: #d4af37;
  font-size: 1.2em;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.champion-theme .match {
  background: rgba(0, 0, 0, 0.6);     /* Dark overlay for contrast */
  color: #fff;
  margin: 10px 0;
  padding: 10px;
  border-radius: 5px;
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.champion-theme .match .teams {
  display: flex;
  justify-content: space-between;
  width: 100%;
}

.champion-theme .match .team {
  flex: 1;
  margin: 0 5px;
  padding: 5px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 3px;
  text-align: center;
  font-size: 0.9em;
}

/* Optional: Add connector lines between rounds */
.champion-theme .bracket-round:not(:last-child)::after {
  content: "";
  position: absolute;
  right: -10px;
  top: 50%;
  width: 10px;
  height: 2px;
  background: #d4af37;
}




/* Adjust drop zones for mobile */
@media (max-width: 768px) {
  .dropZone {
    width: 100%;
    height: 150px; /* Bigger for easy tapping */
    font-size: 1.5em;
  }
}

/* Highlight selected team */
.draggableTeam.selected {
  border: 2px solid var(--gold);
  box-shadow: 0 0 10px var(--gold);
}
























    /* ========================================================
       Mute/Unmute & Theme Toggle Buttons
    ======================================================== */
    #muteBtn, #themeToggle {
      position: fixed; top: 20px;
      background: rgba(0,0,0,0.8); border: 3px solid var(--gold);
      border-radius: 50%; font-size: 1.8em; padding: 12px;
      cursor: pointer; z-index: 130; transition: transform 0.2s ease;
    }
    #muteBtn { right: 110px; }
    #themeToggle { right: 20px; }
    #muteBtn:hover, #themeToggle:hover { transform: scale(1.15); }
    
    /* ========================================================
       Toast Notification
    ======================================================== */
    #toast {
      position: fixed; bottom: 30px; left: 50%;
      transform: translateX(-50%); background: rgba(0,0,0,0.9);
      padding: 15px 25px; border: 2px solid var(--gold);
      border-radius: 8px; box-shadow: 0 0 20px rgba(0,0,0,0.8);
      opacity: 0; pointer-events: none; z-index: 140;
      transition: opacity 0.5s ease;
    }
    #toast.show { opacity: 1; }
    
    /* ========================================================
       Container Styles (Fixed width for desktop view)
    ======================================================== */
    .container {
      width: 1200px; margin: 120px auto 80px; padding: 40px 60px;
      background: var(--container-bg); border-radius: 12px;
      border: 4px solid var(--gold); box-shadow: 0 0 40px rgba(0,0,0,0.95);
      position: relative; z-index: 2; animation: fadeIn 1.5s ease-out;
    }
    .hidden { display: none !important; }
    
    h1, h2, h3 {
      text-align: center; margin-bottom: 20px;
      text-shadow: 0 0 15px var(--gold);
    }
    h1 { font-size: 3em; }
    
#leagueTitle {
  text-align: left;    /* Overrides the center alignment */
  margin-top: 45px;    /* Adjust the top margin */
  margin-bottom: 10px; /* Adjust the bottom margin */
  /* You can add any other custom styles here */
}


/* Style for the Undo button in league mode */
.league-undo-btn {
  background: linear-gradient(45deg, #ff5f6d, #ffc371);
  border: none;
  color: #fff;
  padding: 5px 10px;
  border-radius: 5px;
  margin-left: 10px;
  cursor: pointer;
  transition: transform 0.3s ease;
}

.league-undo-btn:hover {
  transform: scale(1.1);
}

/* Optional: Ensure result buttons have a basic style */
.league-result-btn {
  background: #222;
  color: #fff;
  border: 2px solid var(--gold);
  padding: 5px 10px;
  border-radius: 5px;
  cursor: pointer;
  transition: background 0.3s ease, transform 0.3s ease;
}

.league-result-btn:hover {
  transform: translateY(-2px);
}



















/* ---------------------------
   Enhanced Icon Bar (Horizontal & Scrollable)
---------------------------- */
.icon-bar {
  display: flex;
  gap: 10px;
  margin-top: 5px;
  overflow-x: auto;
  padding-bottom: 5px;
  scroll-behavior: smooth;
}

/* ---------------------------
   Icon Option Styles & Animations
---------------------------- */
/* Redesigned Icon Bar */
.icon-bar {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: 10px;
  padding: 10px;
  background: linear-gradient(45deg, rgba(212,175,55,0.2), rgba(1,33,105,0.2));
  border: 2px solid var(--gold);
  border-radius: 30px;
  overflow-x: auto;
  box-shadow: 0 0 10px rgba(212,175,55, 0.3);
  animation: pulseBackground 5s infinite alternate;
}

@keyframes pulseBackground {
  0% { filter: brightness(0.9); }
  100% { filter: brightness(1.1); }
}

.icon-option {
  width: 35px;
  height: 35px;
  object-fit: cover;
  border: 2px solid transparent;
  border-radius: 100%;
  transition: transform 0.3s ease, border-color 0.3s ease;
  cursor: pointer;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.icon-option:hover {
  transform: scale(1.2);
  border-color: var(--gold);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
}

.icon-option.selected {
  border-color: var(--gold);
  transform: scale(1.3);
  box-shadow: 0 0 20px var(--gold);
}


/* ---------------------------
   Team Icon Style (Used When an Icon is Selected)
---------------------------- */
.team-icon {
  width: 70px;
  height: 70px;
  object-fit: cover;
  margin-bottom: 8px;
}







    /* ========================================================
       Global Leaderboard Section (Setup Page)
    ======================================================== */
    #globalLeaderboardSection {
      border: 2px dashed var(--gold);
      padding: 10px 20px;
      margin-top: 20px;
      border-radius: 8px;
    }
    #globalLeaderboardSection h2 {
      font-size: 1.5em;
      margin-bottom: 10px;
    }
    #clearGlobalBtn {
      margin-top: 10px;
      background: var(--deep-blue);
      border: 2px solid var(--gold);
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    #clearGlobalBtn:hover {
      transform: scale(1.1);
    }
    
    /* ========================================================
       Mode Selection Controls
    ======================================================== */
    .mode-controls { text-align: center; margin-bottom: 20px; }
    .mode-controls label { font-size: 1.4em; margin-right: 20px; }
    
    /* ========================================================
       Knockout Mode Controls
    ======================================================== */
    #knockoutControls { text-align: center; margin-bottom: 20px; }
    
    /* ========================================================
       League Mode Controls (with number input)
    ======================================================== */
    #leagueControls { text-align: center; margin-bottom: 20px; }
    #leagueTeamCount {
      width: 80px; padding: 8px; margin-right: 10px;
      background: #222; border: 2px solid var(--gold); color: var(--white);
      border-radius: 4px; font-size: 1em;
    }
    
    /* ========================================================
       Controls & Forms (common)
    ======================================================== */
    .controls {
      display: flex; flex-wrap: wrap; justify-content: center; align-items: center;
      gap: 20px; margin-bottom: 30px;
    }
    .controls label, .pairing-options label { font-size: 1.2em; }
    select, input[type="text"] {
      background: #222; border: 2px solid var(--gold); color: var(--white);
      padding: 8px 12px; border-radius: 4px; margin-left: 10px; font-size: 1em;
    }
    button {
      background: var(--deep-blue); border: 3px solid var(--gold); color: var(--white);
      padding: 12px 24px; border-radius: 6px; cursor: pointer; font-size: 1.2em;
      transition: transform 0.3s ease, box-shadow 0.3s ease; margin-top: 20px;
    }
    button:hover {
      transform: translateY(-4px); box-shadow: 0 8px 20px rgba(0,0,0,0.8);
    }
    .team-input {
      margin: 10px auto; display: flex; gap: 10px; justify-content: center; align-items: center;
    }
    .team-input input[type="text"] { width: 240px; }
    .team-input input[type="file"] { cursor: pointer; }
    
    /* ========================================================
       Team Block Styles
    ======================================================== */
    .team-block {
      display: flex; flex-direction: column; align-items: center;
      padding: 10px; background: rgba(0,0,0,0.65); border: 2px solid var(--gold);
      border-radius: 10px; margin: 5px; transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .team-block:hover { transform: scale(1.07); box-shadow: 0 0 20px var(--gold); }
    .team-photo {
      width: 70px; height: 70px; border-radius: 50%; object-fit: cover;
      border: 3px solid var(--gold); margin-bottom: 8px;
    }
    .team-name {
      font-size: 1.1em; font-weight: bold; padding: 4px 10px;
      background: rgba(0,0,0,0.8); border-radius: 4px;
    }
    /* Winner, Loser, and Draw Effects */
    .text-winner { color: #00ff00; text-shadow: 0 0 10px #00ff00; animation: winnerGlow 2s infinite; }
    @keyframes winnerGlow {
      0% { transform: scale(1); text-shadow: 0 0 10px #00ff00; }
      50% { transform: scale(1.05); text-shadow: 0 0 20px #00ff00; }
      100% { transform: scale(1); text-shadow: 0 0 10px #00ff00; }
    }
    .text-loser { color: #ff0000; text-shadow: 0 0 10px #ff0000; animation: loserFade 3s infinite; }
    @keyframes loserFade {
      0% { opacity: 1; transform: scale(1); text-shadow: 0 0 10px #ff0000; }
      50% { opacity: 0.7; transform: scale(0.95); text-shadow: 0 0 20px #ff0000; }
      100% { opacity: 0.5; transform: scale(0.9); text-shadow: 0 0 10px #ff0000; }
    }
    .text-draw { color: #888; text-shadow: none; }
    .team-block.draw { border-color: #888; background: #444; }
    .final-winner {
      box-shadow: 0 0 30px #00ff00, 0 0 15px #00ff00;
      animation: finalGlow 2s infinite alternate;
    }
    @keyframes finalGlow { from { filter: brightness(1); } to { filter: brightness(1.4); } }
    .team-block.winner-board { border: 3px solid #00ff00; }
    .team-block.loser-board { border: 3px solid #ff0000; }
    
    /* ========================================================
       Bracket & League Schedule Styles
    ======================================================== */
    #bracket, #championBracket {
      display: flex; gap: 40px; justify-content: center; padding: 40px 0; position: relative;
    }
    #leagueSchedule {
      /* For League mode, enable horizontal scroll if needed */
      overflow-x: auto;
      white-space: nowrap;
      padding: 20px 0;
    }
    .bracket-round { 
      min-width: 250px; 
      position: relative; 
      text-align: center; 
    }
    /* In League mode rounds, display inline-block so they scroll horizontally */
    #leagueSchedule .bracket-round {
      display: inline-block;
      vertical-align: top;
      margin-right: 20px;
    }
    .match {
      background: #111; border: 3px solid var(--deep-blue);
      border-radius: 10px; padding: 20px; margin: 25px 0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.8); position: relative;
      transition: transform 0.3s ease, border 0.3s ease;
    }
    .match:hover { transform: scale(1.05); border-color: var(--gold); }
    .final-match {
      border-color: var(--gold); box-shadow: 0 0 25px var(--gold);
      animation: pulseFinal 2s infinite alternate;
    }
    @keyframes pulseFinal { from { transform: scale(1); } to { transform: scale(1.05); } }
    .connectors { position: absolute; right: -40px; width: 40px; height: 100%; }
    .connector {
      position: absolute; border-right: 3px solid var(--deep-blue);
      border-top: 3px solid var(--deep-blue); width: 40px; height: 50%;
      z-index: -1;
    }
    .connector.top { top: -25%; right: -40px; }
    .connector.bottom { bottom: -25%; right: -40px; }
    
    /* ========================================================
       Manual Pairing Section (Knockout Mode)
    ======================================================== */
    #manualPairingContainer {
      border: 3px dashed var(--gold); padding: 30px; margin-top: 30px;
      border-radius: 10px; background: rgba(20,20,20,0.9);
      position: relative; overflow: hidden;
    }
    #manualPairingContainer::before {
      content: "";
      position: absolute; top: -50%; left: -50%;
      width: 200%; height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.04) 0%, transparent 70%);
      animation: rotateBg 25s linear infinite; z-index: 0;
    }
    @keyframes rotateBg { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    #manualPairingContainer > * { position: relative; z-index: 1; }
    #availableTeams, #formedMatches {
      display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;
      margin-bottom: 20px; animation: fadeIn 1s ease-out;
    }
    .draggableTeam { cursor: grab; transition: transform 0.3s ease; }
    .draggableTeam:hover { transform: scale(1.05); }
    #pairingBucket { display: flex; align-items: center; gap: 20px; animation: slideIn 1s ease-out; }
    .dropZone {
      border: 3px dashed var(--gold); border-radius: 8px;
      width: 240px; height: 130px; display: flex; justify-content: center; align-items: center;
      background: rgba(0,0,0,0.4); transition: background 0.3s ease, transform 0.3s ease;
      font-size: 1.2em;
    }
    .dropZone:hover { background: rgba(212,175,55,0.2); transform: scale(1.04); }
    .dropZone.filled { border-color: var(--gold); background: rgba(212,175,55,0.15); }
    .vs-text { font-size: 1.7em; font-weight: bold; text-shadow: 0 0 10px var(--gold); }
    .manual-pairing-btns {
      display: flex; gap: 10px; justify-content: center; margin-top: 10px;
    }
    
    /* ========================================================
       Champion Display & Trophy Animation
    ======================================================== */
    #championDisplay {
  position: relative;
  /* No background image here */
  padding: 80px 60px;
  border: 4px solid var(--gold);
  text-shadow: 0 0 15px var(--gold);
  overflow: hidden;
}

/* Create a pseudo-element for the champion cup image */
#championDisplay::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: url('assets/icons/champion_cup.jpg') no-repeat center center/cover;
  opacity: 0;  /* Start fully transparent */
  animation: cupFadeIn 2s ease-in-out forwards;
  z-index: -1; /* Ensure it's behind the content */
}

@keyframes cupFadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
    @keyframes pulse { from { transform: scale(1); } to { transform: scale(1.05); } }
    @keyframes bgFade { from { filter: brightness(0.65); } to { filter: brightness(1); } }
    #champion {
      font-size: 3.5em; margin-bottom: 30px;
      animation: glowChampion 2.5s infinite alternate; position: relative;
    }
    @keyframes glowChampion { from { text-shadow: 0 0 10px var(--gold); } to { text-shadow: 0 0 35px var(--gold); } }
    .trophy {
      position: absolute; top: -15px; left: 50%;
      transform: translateX(-50%); width: 100px;
      opacity: 0; animation: trophyAppear 1s forwards;
    }
    @keyframes trophyAppear { 0% { transform: translateX(-50%) scale(0.5); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateX(-50%) scale(1); opacity: 1; } }
    
    /* ========================================================
       Confetti Effects
    ======================================================== */
    .confetti {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none; z-index: 140; overflow: hidden;
    }
    .confetti-piece {
      position: absolute; background: var(--gold); opacity: 0.9;
      border-radius: 3px; animation: fall 3s linear infinite;
    }
    @keyframes fall { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(120vh) rotate(360deg); opacity: 0; } }
    
    /* ========================================================
       Fireworks Canvas (Champion)
    ======================================================== */
    #fireworks {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none; z-index: 150; display: none;
    }
    
    /* ========================================================
       Tournament Modal (for viewing saved tournament bracket)
    ======================================================== */
    #tournamentModal {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.8); display: flex;
      align-items: center; justify-content: center; z-index: 220;
    }
    .tournament-modal-inner {
      background: var(--container-bg); padding: 20px;
      border: 4px solid var(--gold); border-radius: 10px;
      max-width: 800px; width: 90%; text-align: center;
      position: relative; max-height: 90vh; overflow-y: auto;
    }
    
    /* ========================================================
       Feedback Modal Styling
    ======================================================== */
    #feedbackModal {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.8); display: flex;
      align-items: center; justify-content: center; z-index: 210;
    }
    .feedback-inner {
      background: var(--container-bg); padding: 20px;
      border: 4px solid var(--gold); border-radius: 10px;
      max-width: 600px; width: 90%; text-align: center; position: relative;
    }
    
    /* ========================================================
       League Mode Container
    ======================================================== */
  #league {
  width: 1200px;
  margin: 120px auto 80px;
  padding: 40px 60px;
  /* Remove the background image here */
  background: transparent;
  border-radius: 12px;
  border: 4px solid var(--gold);
  box-shadow: 0 0 40px rgba(0,0,0,0.95);
  position: relative;
  z-index: 2;
  animation: fadeIn 1.5s ease-out;
}

/* Pseudo-element for the background image */
#league::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: url('assets/icons/themeL.jpg') no-repeat center center/cover;
  opacity: 1; /* Set desired opacity here (0 to 1) */
  z-index: -1;  /* Ensures it stays behind the content */
}



    #league h2 { text-align: center; margin-bottom: 20px; text-shadow: 0 0 15px var(--gold); }
    #leagueSchedule, #leagueTable, #leagueFinal, #leagueLeaderboard { margin-bottom: 20px; }
    #finishLeagueBtn { margin: 20px auto; display: block; }
    /* After finishLeague is clicked, the button will be hidden */
    
    /* Return Home button for League Mode */
    #leagueReturnBtn {
      margin: 20px auto; display: block;
      background: var(--deep-blue);
      border: 3px solid var(--gold);
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1.2em;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    #leagueReturnBtn:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.8);
    }
    
    /* ========================================================
       Animations
    ======================================================== */
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes slideIn { from { opacity: 0; transform: translateX(-50px); } to { opacity: 1; transform: translateX(0); } }
    
    /* ========================================================
       NEW: League Result Button Styles
         These buttons (for selecting Winner 1, Draw, Winner 2)
         will be reduced in size when many teams are selected (e.g. >8 teams)
    ======================================================== */
    button.league-result-btn {
      font-size: 16px;
      padding: 8px 12px;
      background: var(--deep-blue);
      border: 3px solid var(--gold);
      color: var(--white);
      border-radius: 6px;
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      margin: 0 2px;
    }
    button.league-result-btn:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.8);
    }
    button.league-result-btn.small {
      font-size: 10px;
      padding: 2px 4px;
    }


/* League Schedule Container */
#leagueSchedule {
  display: flex;
  overflow-x: auto;
  padding: 20px 0;
  gap: 30px;
  scroll-behavior: smooth;
}

/* League Round Styling */
#leagueSchedule .bracket-round {
  flex: 0 0 300px;
  min-width: 300px;
  padding: 15px;
  background: rgba(0, 0, 0, 0.7);
  border: 2px solid var(--gold);
  border-radius: 10px;
  transition: transform 0.3s ease;
}

#leagueSchedule .bracket-round:hover {
  transform: translateY(-5px);
}

/* Match Buttons Container */
.match .teams {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

/* Responsive Result Buttons */
.league-result-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  flex-wrap: wrap;
  min-width: 120px;
  padding: 8px 12px;
  font-size: 0.9em;
  transition: all 0.3s ease;
}

.league-result-btn.small {
  min-width: 80px;
  padding: 4px 6px;
  font-size: 0.8em;
}

/* Home/Away Indicator */
.match-home-away {
  font-size: 0.8em;
  color: var(--gold);
  text-align: center;
  margin-top: 5px;
}



#savedTournamentsSection {
  border: 2px dashed var(--gold);
  padding: 10px 20px;
  margin-top: 20px;
  border-radius: 8px;
}
#savedTournamentsList ul {
  list-style: none;
  padding-left: 0;
}
#savedTournamentsList li {
  margin: 10px 0;
}
#savedTournamentsList button {
  margin-left: 10px;
  padding: 5px 10px;
  font-size: 0.9em;
}


#bgImage {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-size: cover;
  background-position: center center;
  z-index: -9999; /* Ensure it's behind everything */
}


@media (max-width: 768px) {
  #bgImage {
    background-attachment: scroll !important;
    width: 100vw;
    height: 100vh;
  }
}









  </style>
</head>
<body class="dark-mode">
  <!-- Mute/Unmute Button -->
  <button id="muteBtn" title="Toggle Sound">üîä</button>
  <!-- Theme Toggle Button -->
  

  <div id="bgImage"></div>
<audio id="bgSound" loop preload="auto"></audio>


  
  <!-- Audio Elements -->
  <audio id="bgSound" src="assets/audio/champions_league_sound.mp3" loop preload="auto"></audio>
  <audio id="winnerSound" src="assets/audio/winner.wav" preload="auto"></audio>
  <audio id="finalSound" src="assets/audio/final.mp3" preload="auto"></audio>
  
  <!-- Toast Notification -->
  <div id="toast"></div>
  
  <!-- Confetti Container -->
  <div class="confetti hidden" id="confettiContainer"></div>
  
  <!-- Fireworks Canvas -->
  <canvas id="fireworks"></canvas>
  
  <!-- SETUP CONTAINER -->
  <div class="container" id="setup">
    <h1> Champions Competition Simulator </h1>
    
    <!-- Global Leaderboard Section -->
    <div id="globalLeaderboardSection">
      <h2>Global Leaderboard</h2>
      <div id="persistentLeaderboardContent">No champions recorded yet.</div>
      <button id="clearGlobalBtn" onclick="clearLeaderboard()">Clear Global Leaderboard</button>
    </div>
    
<div id="savedTournamentsSection">
    <h2>Saved Tournaments</h2>
    <div id="savedTournamentsList"></div>
  </div>

    <!-- Mode Selection -->
    <div class="mode-controls">
   <label>
  <input type="radio" name="mode" value="knockout" checked> Champion Tournament (Knockout)
</label>
<label>
  <input type="radio" name="mode" value="league"> League Tournament
</label>

    </div>
    
    <!-- Knockout Mode Controls -->
    <div id="knockoutControls">
      <label>Number of Teams:
        <select id="teamCount">
          <option value="2">2 Teams</option>
          <option value="4">4 Teams</option>
          <option value="8">8 Teams</option>
          <option value="16" selected>16 Teams</option>
        </select>
      </label>
      <div class="pairing-options" id="pairingOptions">
        <label>
          <input type="radio" name="pairing" value="random" checked> Random Pairing
        </label>
        <label>
          <input type="radio" name="pairing" value="manual"> Manual Pairing
        </label>
      </div>
      <button onclick="generateKnockdownTeams()">Generate Teams</button>
    </div>
    
    <!-- Manual Pairing Container (for Knockout Mode) -->
    <div id="manualPairingContainer" class="hidden">
      <h3>Manual Pairing</h3>
      <p>Drag teams into the slots to create matches</p>
      <div id="availableTeams"></div>
      <div id="pairingBucket">
        <div class="dropZone" id="dropZone1" ondragover="allowDrop(event)" ondrop="dropTeam(event, 1)">Team Slot 1</div>
        <div class="vs-text">VS</div>
        <div class="dropZone" id="dropZone2" ondragover="allowDrop(event)" ondrop="dropTeam(event, 2)">Team Slot 2</div>
      </div>
      <div id="formedMatches"></div>
      <button id="finishPairingBtn" class="hidden" onclick="finishManualPairing()">Finish Pairing</button>
    </div>
    
    <!-- Container for Knockout Team Inputs -->
    <div id="teamInputs"></div>
    <div class="action-buttons">
      <button onclick="startTournament()" id="startBtn" class="hidden">Start Tournament</button>
    </div>
    
    <!-- League Mode Controls -->
    <div id="leagueControls" class="hidden">
      <label>Number of Teams:
        <input type="number" id="leagueTeamCount" value="4" min="2" max="20" />
      </label>
      <div style="margin-top: 10px;">
        <label>League Format:</label>
        <label style="margin-left: 10px;">
          <input type="radio" name="leagueFormat" value="home" checked> Home
        </label>
        <label style="margin-left: 10px;">
          <input type="radio" name="leagueFormat" value="homeAndAway"> Home and Away
        </label>
      </div>
      <button onclick="generateLeagueTeams()">Generate League Teams</button>
      <!-- Container for generated league team inputs -->
      <div id="leagueTeamsContainer"></div>
      <!-- Start League button -->
      <button onclick="startLeagueMode()">Start League</button>
    </div>
  </div>
  
  <!-- TOURNAMENT BRACKET (for Knockout mode) -->
<div class="container hidden" id="tournament">
  <h2 id="roundTitle">üèÜ Tournament Bracket üèÜ</h2>
  <button onclick="undoKnockout()">Undo</button>
  <button onclick="returnHome()">Return Home</button>
  <button onclick="saveCurrentState()">Save Progress</button>
  <div id="bracket"></div>
</div>
  <!-- LEAGUE MODE CONTAINER -->
<div class="container hidden" id="league">
  <h2 id="leagueTitle">League Schedule</h2>
  <button onclick="undoLeague()">Undo</button>
  <button onclick="saveCurrentState()">Save Progress</button>
  <div id="leagueSchedule"></div>
  <h2>League Table</h2>
  <div id="leagueTable"></div>
  <button id="finishLeagueBtn" class="hidden" onclick="finishLeague()">Save League</button>
  <div id="leagueFinal" class="hidden"></div>
  <div id="leagueLeaderboard"></div>
  <button id="leagueReturnBtn" onclick="goToGlobalLeaderboard()">Return Home</button>
</div>  
  <!-- CHAMPION DISPLAY (for Knockout mode) -->
  <div class="container hidden" id="championDisplay">
    <h2>CHAMPION OF EUROPE</h2>
    <img src="assets/icons/favicon.png" alt="Trophy" class="trophy">
    <div id="champion"></div>
    <div id="championBracket"></div>
    <!-- Knockout Tournament Leaderboard -->
    <div id="tournamentLeaderboard"></div>
    <button onclick="location.reload()">New Tournament</button>
    <button onclick="goToGlobalLeaderboard()">Global Leaderboard</button>
    <button onclick="openFeedback()">Feedback</button>
    <button onclick="returnHome()">Return Home</button>
  </div>
  
  <!-- Tournament Modal -->
  <div id="tournamentModal" class="hidden">
    <div class="tournament-modal-inner">
      <h2>Tournament Diagram</h2>
      <div id="tournamentModalContent"></div>
      <button onclick="closeTournamentModal()">Close</button>
    </div>
  </div>
  
  <!-- Feedback Modal -->
  <div id="feedbackModal" class="hidden">
    <div class="feedback-inner">
      <h2>We Value Your Feedback</h2>
      <textarea id="feedbackText" placeholder="Enter your feedback here..." rows="5" style="width: 100%; padding: 10px; border: 2px solid var(--gold); border-radius: 5px; background: transparent; color: inherit;"></textarea>
      <button id="submitFeedback" style="margin-top: 20px;">Submit</button>
      <button style="margin-top: 10px;" onclick="closeFeedback()">Close</button>
    </div>
  </div>
  











  <script>
    /********************
     * Global Variables *
     ********************/

const iconOptions = [
  "assets/icons/icon1.png",
  "assets/icons/icon2.png",
  "assets/icons/icon3.png",
  "assets/icons/icon4.png",
  "assets/icons/icon5.png",
  "assets/icons/icon6.png",
  "assets/icons/icon7.png",
  "assets/icons/icon8.png"
];





let knockoutHistory = [];
let leagueHistory = [];
    let tournament = { rounds: [], currentRound: 0, pairing: 'random', mode: 'knockout', totalTeams: 0 };
    let manualPairing = { availableTeams: [], matches: [], dropSlots: { 1: null, 2: null } };
    let leagueStandings = {}; // For league mode standings
    let groupedChampionRecords = [];
    
    /***********************
     * Mode Change Handler *
     ***********************/


    document.querySelectorAll('input[name="mode"]').forEach(input => {
      input.addEventListener('change', onModeChange);
    });
    function onModeChange() {
  let mode = document.querySelector('input[name="mode"]:checked').value;
  tournament.mode = mode;


  const bgImage = document.getElementById('bgImage');
  const bgSound = document.getElementById('bgSound');
  // Update UI controls for modes
  if (mode === "knockout") {
    document.getElementById('knockoutControls').classList.remove('hidden');
    document.getElementById('teamInputs').classList.remove('hidden');
    document.getElementById('leagueControls').classList.add('hidden');
        document.body.classList.remove('league-theme');
    document.body.classList.add('champion-theme');

    // Set background and audio for Champion League (knockout)
    bgImage.style.background = "url('assets/icons/uefa-champions-league.gif') no-repeat center center";
    bgSound.src = "assets/audio/champions_league_sound.mp3";
  } else if (mode === "league") {
    document.getElementById('leagueControls').classList.remove('hidden');
    document.getElementById('teamInputs').classList.add('hidden');
    document.getElementById('knockoutControls').classList.add('hidden');
        document.body.classList.add('league-theme');
    document.body.classList.remove('champion-theme');

    bgImage.style.background = "url('assets/icons/premiere-league-premiere-league-logo.gif') no-repeat center center";
    bgSound.src =  "assets/audio/English_Premier_League.mp3";
  }
  
 // Ensure background covers the whole viewport
  bgImage.style.backgroundSize = "cover";
  
  // Reload audio
  bgSound.load();
  bgSound.play().then(() => {
    console.log('Sound is playing');
  }).catch(err => {
    console.log('Audio playback failed (likely due to auto-play restrictions), please interact with the page to start the sound.', err);
  });
}
    
  /*********************
   * Audio & Mute Control *
   *********************/
  const muteBtn = document.getElementById('muteBtn');
  const bgSound = document.getElementById('bgSound');
  
  // On page load, retrieve the stored mute setting (if any)
  const storedMute = localStorage.getItem('isMuted');
  if (storedMute !== null) {
    bgSound.muted = storedMute === 'true'; // stored as string "true" or "false"
    muteBtn.textContent = bgSound.muted ? 'üîá' : 'üîä';
  }
  
  // Toggle mute on button click and save the state
  muteBtn.addEventListener('click', () => {
    bgSound.muted = !bgSound.muted;
    muteBtn.textContent = bgSound.muted ? 'üîá' : 'üîä';
    localStorage.setItem('isMuted', bgSound.muted);
  });
  


 // Optionally, if you use tryPlayBgSound (or similar), it will work as before.
  let bgSoundPlayed = false;
  function tryPlayBgSound() {
    if (!bgSoundPlayed) {
      bgSound.play().then(() => { bgSoundPlayed = true; })
        .catch(err => console.error("Error playing sound:", err));
    }
  }
  document.addEventListener('click', tryPlayBgSound, { once: true });






 
    
    /*********************
     * Toast Notifications *
     *********************/
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => { toast.classList.remove('show'); }, 3000);
    }
    function showError(message) { showToast(message); }
    
    /*********************
     * Rendering Helpers *
     *********************/
function renderTeam(team, status) {
  let extraClass = (status === "draw") ? "draw" : "";
  let boardClass = "";
  if (status === "winner" || status === "final-winner") boardClass = "winner-board";
  else if (status === "loser") boardClass = "loser-board";
  
  // Use team.icon if available; otherwise, use team.photo.
  let imgHtml = "";
  if (team.icon) {
    imgHtml = `<img src="${team.icon}" class="team-icon" alt="${team.name} Icon">`;
  } else if (team.photo) {
    imgHtml = `<img src="${team.photo}" class="team-photo" alt="${team.name} Logo">`;
  }
  
  return `
    <div class="team-block ${status === 'final-winner' ? 'final-winner' : ''} ${boardClass} ${extraClass}">
      ${imgHtml}
      <div class="team-name ${status ? 'text-' + status : ''}">${team.name}</div>
    </div>
  `;
}


    
    /********************
     * Knockout Mode Functions *
     ********************/
function generateKnockdownTeams() {
  let count = parseInt(document.getElementById('teamCount').value);
  tournament.totalTeams = count;
  let container = document.getElementById('teamInputs');
  container.innerHTML = '';
  document.getElementById('manualPairingContainer').classList.add('hidden');

  // Define your icon options globally (if not already defined)
  const iconOptions = [
   "assets/icons/icon1.png",
  "assets/icons/icon2.png",
  "assets/icons/icon3.png",
  "assets/icons/icon4.png",
  "assets/icons/icon5.png",
  "assets/icons/icon6.png",
  "assets/icons/icon7.png",
  "assets/icons/icon8.png"
  ];

  for (let i = 0; i < count; i++) {
    let div = document.createElement('div');
    div.className = 'team-input';

    // Create the team name input
    let nameInput = document.createElement('input');
    nameInput.type = 'text';
    nameInput.placeholder = `Team ${i+1} Name`;
    nameInput.required = true;
    nameInput.value = `Team ${i+1}`;
    div.appendChild(nameInput);

    // Create the file input for uploading a picture
    let photoInput = document.createElement('input');
    photoInput.type = 'file';
    photoInput.accept = 'image/*';
    photoInput.style.cursor = 'pointer';
    photoInput.addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) { 
          // Store the uploaded image data
          photoInput.dataset.photo = e.target.result;
        }
        reader.readAsDataURL(file);
      }
    });
    div.appendChild(photoInput);

    // Append the smooth icon bar using our new function
    div.appendChild(createIconBar(photoInput));

    container.appendChild(div);
  }
  document.getElementById('startBtn').classList.remove('hidden');
}
 function startTournament() {

document.querySelector('meta[name="viewport"]').setAttribute('content', 'width=1200, initial-scale=1');

  let teamDivs = Array.from(document.getElementById('teamInputs').children);
  let teams = teamDivs.map(div => {
    let name = div.querySelector('input[type="text"]').value.trim();
    let photoInput = div.querySelector('input[type="file"]');
    let icon = photoInput.dataset.icon || "";
    let photo = photoInput.dataset.photo || "";
    if (!name) throw new Error("Please fill in all team names.");
    return { name, photo, icon };
  });
  knockoutHistory = [{ type: 'setup', teams: teams.map(team => ({ name: team.name, icon: team.icon, photo: team.photo })) }]; // Include icon and photo

  if (new Set(teams.map(t => t.name)).size !== teams.length)
    throw new Error("Team names must be unique.");
  if (teams.length !== parseInt(document.getElementById('teamCount').value))
    throw new Error("Incorrect number of teams entered.");
  tournament.pairing = document.querySelector('input[name="pairing"]:checked').value;
  tournament.initialTeams = teams; // Store initial teams
  if (tournament.pairing === "random") {
    tournament.rounds = [{ matches: createRandomPairs(teams) }];
    knockoutHistory = [{ type: 'setup', teams: teams }]; // Initialize history with setup state
    document.getElementById('setup').classList.add('hidden');
    document.getElementById('tournament').classList.remove('hidden');
    renderBracket();
  } else {
    document.getElementById('teamInputs').classList.add('hidden');
    startManualPairing(teams);
  }
}

function finishManualPairing() {
  tournament.rounds = [{ matches: manualPairing.matches.slice() }];
  knockoutHistory = [{ type: 'setup', teams: tournament.initialTeams }]; // Initialize history with setup state
  document.getElementById('manualPairingContainer').classList.add('hidden');
  document.getElementById('setup').classList.add('hidden');
  document.getElementById('tournament').classList.remove('hidden');
  renderBracket();
}
    function createRandomPairs(teams) {
      const shuffled = teams.slice().sort(() => Math.random() - 0.5);
      const matches = [];
      for (let i = 0; i < shuffled.length; i += 2)
        matches.push({ team1: shuffled[i], team2: shuffled[i+1], winner: null });
      return matches;
    }
    
    function renderBracket() {
  const bracketDiv = document.getElementById('bracket');
  bracketDiv.innerHTML = '';

  tournament.rounds.forEach((round, roundIndex) => {
    const roundDiv = document.createElement('div');
    roundDiv.className = 'bracket-round';
    roundDiv.innerHTML = `<h3>${getRoundName(round.matches.length * 2)}</h3>`;

    round.matches.forEach((match, matchIndex) => {
      const matchDiv = document.createElement('div');
      matchDiv.className = 'match';
      matchDiv.id = `match-${roundIndex}-${matchIndex}`; // Assign unique ID
      const teamsContainer = document.createElement('div');
      teamsContainer.className = 'teams';

      let team1Status = "";
      let team2Status = "";
      if (match.winner) {
        team1Status = (match.team1.name === match.winner.name) ? "winner" : "loser";
        team2Status = (match.team2.name === match.winner.name) ? "winner" : "loser";
        if (round.matches.length === 1) {
          team1Status = (match.team1.name === match.winner.name) ? "final-winner" : team1Status;
          team2Status = (match.team2.name === match.winner.name) ? "final-winner" : team2Status;
        }
      }

      const team1Div = document.createElement('div');
      team1Div.innerHTML = renderTeam(match.team1, team1Status);
      team1Div.style.cursor = "pointer";
      team1Div.addEventListener('click', () => selectWinner(roundIndex, matchIndex, match.team1));

      const team2Div = document.createElement('div');
      team2Div.innerHTML = renderTeam(match.team2, team2Status);
      team2Div.style.cursor = "pointer";
      team2Div.addEventListener('click', () => selectWinner(roundIndex, matchIndex, match.team2));

      teamsContainer.appendChild(team1Div);
      let vsText = document.createElement('div');
      vsText.textContent = " vs ";
      vsText.style.margin = "0 5px";
      teamsContainer.appendChild(vsText);
      teamsContainer.appendChild(team2Div);
      matchDiv.appendChild(teamsContainer);

      if (roundIndex < tournament.rounds.length - 1) {
        const connectors = document.createElement('div');
        connectors.className = 'connectors';
        connectors.innerHTML = `<div class="connector top"></div><div class="connector bottom"></div>`;
        matchDiv.appendChild(connectors);
      }

      roundDiv.appendChild(matchDiv);
    });

    bracketDiv.appendChild(roundDiv);
  });
  adjustPositions(bracketDiv);
}
    
 function selectWinner(roundIndex, matchIndex, winner) {
  const championDisplay = document.getElementById('championDisplay');
  const tournamentDiv = document.getElementById('tournament');
  if (!championDisplay.classList.contains('hidden')) {
    championDisplay.classList.add('hidden');
    tournamentDiv.classList.remove('hidden');
  }

  const match = tournament.rounds[roundIndex].matches[matchIndex];
  knockoutHistory.push({ type: 'rounds', rounds: JSON.parse(JSON.stringify(tournament.rounds)) });
  if (match.winner && match.winner.name !== winner.name) {
    tournament.rounds = tournament.rounds.slice(0, roundIndex + 1);
    tournament.currentRound = roundIndex;
  }
  match.winner = winner;
  renderBracket();

  if (tournament.rounds[tournament.currentRound].matches.every(m => m.winner)) {
    createNextRound();
  } else {
    // Scroll to the next undecided match in the current round
    let nextMatchIndex = tournament.rounds[tournament.currentRound].matches.findIndex(
      (m, idx) => idx > matchIndex && !m.winner
    );
    if (nextMatchIndex === -1) {
      // Wrap around to the first undecided match if none found after current index
      nextMatchIndex = tournament.rounds[tournament.currentRound].matches.findIndex(m => !m.winner);
    }
    if (nextMatchIndex !== -1) {
      const matchId = `match-${tournament.currentRound}-${nextMatchIndex}`;
      setTimeout(() => {
        const matchElement = document.getElementById(matchId);
        if (matchElement) {
          matchElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      }, 100); // Delay to ensure DOM updates
    }
  }
}
    function createNextRound() {
  const currentMatches = tournament.rounds[tournament.currentRound].matches;
  const winners = currentMatches.map(m => m.winner);
  if (winners.length === 1) {
    showChampion(winners[0]);
    return;
  }
  const nextRoundMatches = [];
  for (let i = 0; i < winners.length; i += 2)
    nextRoundMatches.push({ team1: winners[i], team2: winners[i+1], winner: null });
  tournament.rounds.push({ matches: nextRoundMatches });
  tournament.currentRound++;
  renderBracket();

  // Scroll to the first match of the new round
  const firstMatchId = `match-${tournament.currentRound}-0`;
  setTimeout(() => {
    const matchElement = document.getElementById(firstMatchId);
    if (matchElement) {
      matchElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }, 100); // Delay to ensure DOM updates
}
    
    function getRoundName(teamCount) {
      const names = { 16: 'Round of 16', 8: 'Quarter Finals', 4: 'Semi Finals', 2: 'Final' };
      return names[teamCount] || `Round ${tournament.currentRound + 1}`;
    }
    
    /********************
     * Manual Pairing Functions (Knockout Mode) *
     ********************/
    function startManualPairing(teams) {
      manualPairing.availableTeams = teams.slice();
      manualPairing.matches = [];
      manualPairing.dropSlots = { 1: null, 2: null };
      document.getElementById('manualPairingContainer').classList.remove('hidden');
      updateAvailableTeamsUI();
    }
    function updateAvailableTeamsUI() {
      const container = document.getElementById('availableTeams');
      container.innerHTML = '';
      manualPairing.availableTeams.forEach((team, index) => {
        const div = document.createElement('div');
        div.innerHTML = renderTeam(team);
        div.className = 'draggableTeam';
        div.setAttribute('draggable', 'true');
        div.setAttribute('data-index', index);
        div.addEventListener('dragstart', dragStart);
        container.appendChild(div);
      });
    }
    function dragStart(event) {
      event.dataTransfer.setData("text/plain", event.currentTarget.getAttribute("data-index"));
    }
    function allowDrop(event) { event.preventDefault(); }
   function dropTeam(event, zoneNumber) {
  event.preventDefault();
  const index = event.dataTransfer.getData("text/plain");
  if (manualPairing.dropSlots[zoneNumber] !== null) return;
  knockoutHistory.push({ type: 'manualPairing', manualPairing: JSON.parse(JSON.stringify(manualPairing)) }); // Save state before drop
  const team = manualPairing.availableTeams[index];
  manualPairing.dropSlots[zoneNumber] = team;
  const dropZone = document.getElementById("dropZone" + zoneNumber);
  dropZone.innerHTML = renderTeam(team);
  dropZone.classList.add('filled');
  manualPairing.availableTeams.splice(index, 1);
  updateAvailableTeamsUI();
  if (manualPairing.dropSlots[1] && manualPairing.dropSlots[2]) {
    formMatchFromDropZones();
  }
}
    function formMatchFromDropZones() {
      const teamA = manualPairing.dropSlots[1];
      const teamB = manualPairing.dropSlots[2];
      manualPairing.matches.push({ team1: teamA, team2: teamB, winner: null });
      updateFormedMatchesUI();
      manualPairing.dropSlots = { 1: null, 2: null };
      document.getElementById("dropZone1").innerHTML = "Team Slot 1";
      document.getElementById("dropZone1").classList.remove('filled');
      document.getElementById("dropZone2").innerHTML = "Team Slot 2";
      document.getElementById("dropZone2").classList.remove('filled');
      if (manualPairing.availableTeams.length === 0) {
        document.getElementById('finishPairingBtn').classList.remove('hidden');
      }
    }
    function updateFormedMatchesUI() {
      const container = document.getElementById('formedMatches');
      container.innerHTML = '';
      manualPairing.matches.forEach(match => {
        const div = document.createElement('div');
        div.innerHTML = `${renderTeam(match.team1)} vs ${renderTeam(match.team2)}`;
        container.appendChild(div);
      });
    }
    function finishManualPairing() {
  tournament.rounds = [{ matches: manualPairing.matches.slice() }];
  knockoutHistory = []; // Reset history
  document.getElementById('manualPairingContainer').classList.add('hidden');
  document.getElementById('setup').classList.add('hidden');
  document.getElementById('tournament').classList.remove('hidden');
  renderBracket();
}
    
    /********************
     * League Mode Functions *
     ********************/
function generateLeagueTeams() {
  let count = parseInt(document.getElementById('leagueTeamCount').value);
  let container = document.getElementById('leagueTeamsContainer');
  container.innerHTML = '';

  // Define your icon options (if not defined globally)
  const iconOptions = [
  "assets/icons/icon1.png",
  "assets/icons/icon2.png",
  "assets/icons/icon3.png",
  "assets/icons/icon4.png",
  "assets/icons/icon5.png",
  "assets/icons/icon6.png",
  "assets/icons/icon7.png",
  "assets/icons/icon8.png"

  ];

  for (let i = 0; i < count; i++) {
    let div = document.createElement('div');
    div.className = 'team-input';

    // Create the team name input
    let nameInput = document.createElement('input');
    nameInput.type = 'text';
    nameInput.placeholder = `Team ${i+1} Name`;
    nameInput.required = true;
    nameInput.value = `Team ${i+1}`;
    div.appendChild(nameInput);

    // Create the file input for uploading a picture
    let photoInput = document.createElement('input');
    photoInput.type = 'file';
    photoInput.accept = 'image/*';
    photoInput.style.cursor = 'pointer';
    photoInput.addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          photoInput.dataset.photo = e.target.result;
        }
        reader.readAsDataURL(file);
      }
    });
    div.appendChild(photoInput);

    // Append the smooth icon bar using our new function
    div.appendChild(createIconBar(photoInput));

    container.appendChild(div);
  }
}
    
function startLeagueMode() {
  tournament.leagueFormat = document.querySelector('input[name="leagueFormat"]:checked').value;
  let container = document.getElementById('leagueTeamsContainer');
  let teamDivs = Array.from(container.getElementsByClassName('team-input'));
  let teams = [];
  teamDivs.forEach(div => {
    let name = div.querySelector('input[type="text"]').value.trim();
    let photoInput = div.querySelector('input[type="file"]');
    let icon = photoInput.dataset.icon || "";
    let photo = photoInput.dataset.photo || "";
    if (!name) {
      showToast("Please fill in all team names.");
      return;
    }
    teams.push({ name, photo, icon });
  });
  if (teams.length < 2) {
    showToast("At least 2 teams are required for league mode.");
    return;
  }
  tournament.totalTeams = teams.length;
  tournament.initialTeams = teams; // Store initial teams
  initializeLeague(teams);
leagueHistory = [{ type: 'setup', teams: teams.map(team => ({ name: team.name, icon: team.icon, photo: team.photo })) }];  document.getElementById('setup').classList.add('hidden');
  document.getElementById('league').classList.remove('hidden');
  renderLeagueSchedule();
  updateLeagueTable();
  adjustLeagueRounds();
}    
    function initializeLeague(teams) {
      tournament.rounds = generateLeagueSchedule(teams);
      leagueStandings = {};
      teams.forEach(team => {
        leagueStandings[team.name] = { played: 0, wins: 0, draws: 0, losses: 0, points: 0 };
      });
    }
    
    function generateLeagueSchedule(teams) {
  let n = teams.length;
  let rounds = [];
  let teamsList = teams.slice();
  
  if (n % 2 !== 0) {
    teamsList.push(null);
    n++;
  }

  // Generate home rounds
  let homeRounds = [];
  for (let round = 0; round < n - 1; round++) {
    let matches = [];
    for (let i = 0; i < n / 2; i++) {
      let team1 = teamsList[i];
      let team2 = teamsList[n - 1 - i];
      if (team1 && team2) {
        matches.push({ 
          team1: team1, 
          team2: team2,
          winner: null,
          result: null,
          isHomeMatch: true
        });
      }
    }
    homeRounds.push({ matches: matches });
    teamsList.splice(1, 0, teamsList.pop());
  }

  // For home/away, create reverse fixtures
  if (tournament.leagueFormat === "homeAndAway") {
    let awayRounds = homeRounds.map(round => {
      return {
        matches: round.matches.map(match => ({
          team1: match.team2,
          team2: match.team1,
          winner: null,
          result: null,
          isHomeMatch: false
        }))
      };
    });
    rounds = [...homeRounds, ...awayRounds];
  } else {
    rounds = homeRounds;
  }

  return rounds;
}
    
    function renderLeagueSchedule() {
  const scheduleDiv = document.getElementById('leagueSchedule');
  scheduleDiv.innerHTML = "";

  tournament.rounds.forEach((round, roundIndex) => {
    let roundDiv = document.createElement('div');
    roundDiv.className = 'bracket-round';
    roundDiv.innerHTML = `<h3>Round ${roundIndex + 1}</h3>`;

    round.matches.forEach((match, matchIndex) => {
      let matchDiv = document.createElement('div');
      matchDiv.className = 'match';
      let teamsContainer = document.createElement('div');
      teamsContainer.className = 'teams';

      // Create result buttons
   
       let team1Btn = document.createElement('button');
team1Btn.className = 'league-result-btn' + (tournament.totalTeams > 8 ? ' small' : '');
team1Btn.onclick = () => selectLeagueResult(roundIndex, matchIndex, "win", match.team1);

let team1Content = "";
if (match.team1.icon) {
  team1Content = `<img src="${match.team1.icon}" alt="${match.team1.name} icon" style="width:24px; height:24px; border-radius:50%; margin-right:5px;">`;
} else if (match.team1.photo) {
  team1Content = `<img src="${match.team1.photo}" alt="${match.team1.name} photo" style="width:24px; height:24px; border-radius:50%; margin-right:5px;">`;
}
team1Content += match.team1.name;
team1Btn.innerHTML = team1Content;



      team1Btn.className = 'league-result-btn' + (tournament.totalTeams > 8 ? ' small' : '');
      team1Btn.onclick = () => selectLeagueResult(roundIndex, matchIndex, "win", match.team1);

      let drawBtn = document.createElement('button');
      drawBtn.textContent = "Draw";
      drawBtn.className = 'league-result-btn' + (tournament.totalTeams > 8 ? ' small' : '');
      drawBtn.onclick = () => selectLeagueResult(roundIndex, matchIndex, "draw");


let team2Btn = document.createElement('button');
team2Btn.className = 'league-result-btn' + (tournament.totalTeams > 8 ? ' small' : '');
team2Btn.onclick = () => selectLeagueResult(roundIndex, matchIndex, "win", match.team2);

let team2Content = "";
if (match.team2.icon) {
  team2Content = `<img src="${match.team2.icon}" alt="${match.team2.name} icon" style="width:24px; height:24px; border-radius:50%; margin-right:5px;">`;
} else if (match.team2.photo) {
  team2Content = `<img src="${match.team2.photo}" alt="${match.team2.name} photo" style="width:24px; height:24px; border-radius:50%; margin-right:5px;">`;
}
team2Content += match.team2.name;
team2Btn.innerHTML = team2Content;



      team2Btn.className = 'league-result-btn' + (tournament.totalTeams > 8 ? ' small' : '');
      team2Btn.onclick = () => selectLeagueResult(roundIndex, matchIndex, "win", match.team2);

      // Apply color theming if a result is set
      if (match.result) {
        if (match.result === "win") {
          // Set winner (green) and loser (red)
          if (match.winner && match.team1.name === match.winner.name) {
            team1Btn.style.backgroundColor = "#00ff00"; // green
            team2Btn.style.backgroundColor = "#ff0000"; // red
          } else if (match.winner && match.team2.name === match.winner.name) {
            team2Btn.style.backgroundColor = "#00ff00";
            team1Btn.style.backgroundColor = "#ff0000";
          }
        } else if (match.result === "draw") {
          drawBtn.style.backgroundColor = "#888888"; // grey for draw
        }
      }

      teamsContainer.appendChild(team1Btn);
      teamsContainer.appendChild(drawBtn);
      teamsContainer.appendChild(team2Btn);

      // Add an Undo button if a result exists
      if (match.result) {
        let undoBtn = document.createElement('button');
        undoBtn.textContent = "Undo";
        undoBtn.className = "league-undo-btn";
        undoBtn.onclick = () => undoLeagueResult(roundIndex, matchIndex);
        teamsContainer.appendChild(undoBtn);
      }

      matchDiv.appendChild(teamsContainer);
      roundDiv.appendChild(matchDiv);
    });
    scheduleDiv.appendChild(roundDiv);
  });
  adjustLeagueRounds();
}



function undoLeagueResult(roundIndex, matchIndex) {
  let match = tournament.rounds[roundIndex].matches[matchIndex];
  
  // If no result exists, nothing to undo.
  if (!match.result) return;
  
  // Undo the previous result‚Äôs impact on leagueStandings.
  if (match.result === "win") {
    let prevWinner = match.winner;
    let prevLoser = (match.team1.name === prevWinner.name) ? match.team2 : match.team1;
    leagueStandings[prevWinner.name].played--;
    leagueStandings[prevWinner.name].wins--;
    leagueStandings[prevWinner.name].points -= 3;
    leagueStandings[prevLoser.name].played--;
    leagueStandings[prevLoser.name].losses--;
  } else if (match.result === "draw") {
    leagueStandings[match.team1.name].played--;
    leagueStandings[match.team1.name].draws--;
    leagueStandings[match.team1.name].points -= 1;
    leagueStandings[match.team2.name].played--;
    leagueStandings[match.team2.name].draws--;
    leagueStandings[match.team2.name].points -= 1;
  }
  
  // Clear the match result.
  match.result = null;
  match.winner = null;
  
  // Re-render the schedule and update the standings.
  renderLeagueSchedule();
  updateLeagueTable();
}












    
    // Adjust league round widths so they scroll horizontally
   function adjustLeagueRounds() {
  const scheduleContainer = document.getElementById('leagueSchedule');
  const rounds = scheduleContainer.querySelectorAll('.bracket-round');
  const containerWidth = scheduleContainer.clientWidth;
  const minRoundWidth = 300;
  
  scheduleContainer.style.gap = `${Math.min(30, containerWidth * 0.03)}px`;
  
  rounds.forEach(round => {
    round.style.flex = `0 0 ${minRoundWidth}px`;
    round.style.minWidth = `${minRoundWidth}px`;
  });
}
    
function selectLeagueResult(roundIndex, matchIndex, resultType, winningTeam) {
  const leagueFinal = document.getElementById('leagueFinal');
  if (leagueFinal && !leagueFinal.classList.contains('hidden')) {
    leagueFinal.classList.add('hidden');
  }
  let match = tournament.rounds[roundIndex].matches[matchIndex];
  leagueHistory.push({
    type: 'league',
    rounds: JSON.parse(JSON.stringify(tournament.rounds)),
    standings: JSON.parse(JSON.stringify(leagueStandings))
  });

  if (match.result) {
    if (match.result === "win") {
      let prevWinner = match.winner;
      let prevLoser = (match.team1.name === prevWinner.name) ? match.team2 : match.team1;
      leagueStandings[prevWinner.name].played--;
      leagueStandings[prevWinner.name].wins--;
      leagueStandings[prevWinner.name].points -= 3;
      leagueStandings[prevLoser.name].played--;
      leagueStandings[prevLoser.name].losses--;
    } else if (match.result === "draw") {
      leagueStandings[match.team1.name].played--;
      leagueStandings[match.team1.name].draws--;
      leagueStandings[match.team1.name].points -= 1;
      leagueStandings[match.team2.name].played--;
      leagueStandings[match.team2.name].draws--;
      leagueStandings[match.team2.name].points -= 1;
    }
  }

  if (resultType === "win") {
    match.result = "win";
    match.winner = winningTeam;
    let loser = (match.team1.name === winningTeam.name) ? match.team2 : match.team1;
    leagueStandings[winningTeam.name].played++;
    leagueStandings[winningTeam.name].wins++;
    leagueStandings[winningTeam.name].points += 3;
    leagueStandings[loser.name].played++;
    leagueStandings[loser.name].losses++;
  } else if (resultType === "draw") {
    match.result = "draw";
    match.winner = null;
    leagueStandings[match.team1.name].played++;
    leagueStandings[match.team1.name].draws++;
    leagueStandings[match.team1.name].points += 1;
    leagueStandings[match.team2.name].played++;
    leagueStandings[match.team2.name].draws++;
    leagueStandings[match.team2.name].points += 1;
  }

  renderLeagueSchedule();
  updateLeagueTable();

  if (isLeagueComplete()) {
    document.getElementById('finishLeagueBtn').classList.remove('hidden');
  }
}    function updateLeagueTable() {
      const tableDiv = document.getElementById('leagueTable');
      let teams = [];
      for (let team in leagueStandings) {
        teams.push({ name: team, ...leagueStandings[team] });
      }
      teams.sort((a, b) => (b.points - a.points) || (b.wins - a.wins));
      let html = `<table style="width:100%; border-collapse: collapse; text-align: center;">
                    <tr style="border-bottom: 2px solid var(--gold);">
                      <th>Team</th><th>Played</th><th>Wins</th><th>Draws</th><th>Losses</th><th>Points</th>
                    </tr>`;
      teams.forEach((team, index) => {
        let medal = "";
        if(index === 0) medal = "ü•á ";
        else if(index === 1) medal = "ü•à ";
        else if(index === 2) medal = "ü•â ";
        html += `<tr style="border-bottom: 1px solid #555;">
                    <td>${medal}${team.name}</td>
                    <td>${team.played}</td>
                    <td>${team.wins}</td>
                    <td>${team.draws}</td>
                    <td>${team.losses}</td>
                    <td>${team.points}</td>
                 </tr>`;
      });
      html += `</table>`;
      tableDiv.innerHTML = html;
    }
    
    function isLeagueComplete() {
      for (let round of tournament.rounds) {
        for (let match of round.matches) {
          if (!match.result) return false;
        }
      }
      return true;
    }
    
    function finishLeague() {
      let teams = [];
      for (let team in leagueStandings) {
        teams.push({ name: team, ...leagueStandings[team] });
      }
      teams.sort((a, b) => (b.points - a.points) || (b.wins - a.wins));
      let champion = teams[0];
      let finalDiv = document.getElementById('leagueFinal');
      finalDiv.innerHTML = `<h2>League Champion: ${champion.name}</h2>
                            <p>Played: ${champion.played} | Wins: ${champion.wins} | Draws: ${champion.draws} | Losses: ${champion.losses} | Points: ${champion.points}</p>
                            <img src="assets/icons/favicon.png" alt="Trophy" class="trophy">`;
      finalDiv.classList.remove('hidden');
      document.getElementById('finalSound').play().catch(err => console.error("Final sound error:", err));
      createConfetti();
      createParticles();
      showFireworks();
      saveChampion({ name: champion.name, photo: "", rounds: tournament.rounds, mode: "league", table: leagueStandings });
      document.getElementById('leagueLeaderboard').innerHTML = renderLeagueLeaderboard();
      // Hide the finish league button so it is not visible again.
      document.getElementById('finishLeagueBtn').classList.add('hidden');
    }
    
    function renderLeagueLeaderboard() {
      let teams = [];
      for (let team in leagueStandings) {
        teams.push({ name: team, ...leagueStandings[team] });
      }
      teams.sort((a, b) => (b.points - a.points) || (b.wins - a.wins));
      let topThree = teams.slice(0, 3);
      let medalIcons = ["ü•á", "ü•à", "ü•â"];
      let html = `<h3>League Leaderboard (Top 3)</h3>
                  <table style="width:100%; border-collapse: collapse; text-align: center;">
                    <tr style="border-bottom: 2px solid var(--gold);">
                      <th>Rank</th><th>Team</th><th>Points</th>
                    </tr>`;
      topThree.forEach((team, index) => {
        html += `<tr style="border-bottom: 1px solid #555;">
                    <td>${medalIcons[index]}</td>
                    <td>${team.name}</td>
                    <td>${team.points}</td>
                 </tr>`;
      });
      html += `</table>`;
      return html;
    }
    
    /********************
     * Champion Display (Knockout) *
     ********************/
    function showChampion(winner) {
      document.getElementById('tournament').classList.add('hidden');
      document.getElementById('championDisplay').classList.remove('hidden');
      document.getElementById('confettiContainer').classList.remove('hidden');
      createConfetti();
      createParticles();
      showFireworks();
      document.getElementById('champion').innerHTML = renderTeam(winner, "final-winner");
      renderChampionBracket();
      saveChampion({ name: winner.name, photo: winner.photo || "", rounds: tournament.rounds, mode: "knockout" });
      document.getElementById('tournamentLeaderboard').innerHTML = renderKnockoutLeaderboard();
    }
    
    function renderKnockoutLeaderboard() {
      let totalTeams = tournament.totalTeams;
      let leaderboard = [];
      if (tournament.rounds.length > 0) {
        let finalRound = tournament.rounds[tournament.rounds.length - 1];
        if (finalRound.matches[0].winner) {
          leaderboard.push({ name: finalRound.matches[0].winner.name, rank: 1 });
        }
      }
      for (let i = 0; i < tournament.rounds.length; i++) {
        let round = tournament.rounds[i];
        let rank;
        if (i === tournament.rounds.length - 1) {
          rank = 2;
        } else {
          rank = Math.floor(totalTeams / Math.pow(2, (i+1))) + 1;
        }
        round.matches.forEach(match => {
          if (match.winner) {
            let loser = (match.team1.name === match.winner.name) ? match.team2 : match.team1;
            leaderboard.push({ name: loser.name, rank: rank });
          }
        });
      }
      let leaderboardMap = {};
      leaderboard.forEach(entry => {
        if (!leaderboardMap[entry.name] || entry.rank < leaderboardMap[entry.name].rank) {
          leaderboardMap[entry.name] = entry;
        }
      });
      leaderboard = Object.values(leaderboardMap);
      leaderboard.sort((a, b) => a.rank - b.rank);
      let html = `<h3>Tournament Leaderboard</h3>
                  <table style="width:100%; border-collapse: collapse; text-align: center;">
                    <tr style="border-bottom: 2px solid var(--gold);">
                      <th>Rank</th><th>Team</th>
                    </tr>`;
      leaderboard.forEach(entry => {
        html += `<tr style="border-bottom: 1px solid #555;">
                    <td>${entry.rank}</td><td>${entry.name}</td>
                 </tr>`;
      });
      html += `</table>`;
      return html;
    }
    
    function renderChampionBracket() {
      const championBracket = document.getElementById('championBracket');
      championBracket.innerHTML = '';
      tournament.rounds.forEach((round, roundIndex) => {
        const roundDiv = document.createElement('div');
        roundDiv.className = 'bracket-round';
        roundDiv.innerHTML = `<h3>${getRoundName(round.matches.length * 2)}</h3>`;
        round.matches.forEach(match => {
          const matchDiv = document.createElement('div');
          matchDiv.className = 'match';
          const teamsContainer = document.createElement('div');
          teamsContainer.className = 'teams';
          const team1Div = document.createElement('div');
          team1Div.innerHTML = renderTeam(match.team1, (match.team1.name === match.winner?.name) ? "final-winner" : "loser");
          const team2Div = document.createElement('div');
          team2Div.innerHTML = renderTeam(match.team2, (match.team2.name === match.winner?.name) ? "final-winner" : "loser");
          const vsText = document.createElement('div');
          vsText.textContent = " vs ";
          vsText.style.margin = "0 5px";
          teamsContainer.appendChild(team1Div);
          teamsContainer.appendChild(vsText);
          teamsContainer.appendChild(team2Div);
          matchDiv.appendChild(teamsContainer);
          if (roundIndex < tournament.rounds.length - 1) {
            const connectors = document.createElement('div');
            connectors.className = 'connectors';
            connectors.innerHTML = `<div class="connector top"></div><div class="connector bottom"></div>`;
            matchDiv.appendChild(connectors);
          }
          roundDiv.appendChild(matchDiv);
        });
        championBracket.appendChild(roundDiv);
      });
      adjustPositions(championBracket);
    }
    
    /********************
     * Confetti Effect  *
     ********************/
    function createConfetti() {
      const confettiContainer = document.getElementById('confettiContainer');
      confettiContainer.innerHTML = '';
      for (let i = 0; i < 150; i++) {
        const piece = document.createElement('div');
        piece.classList.add('confetti-piece');
        piece.style.left = Math.random() * 100 + '%';
        piece.style.width = 8 + Math.random() * 12 + 'px';
        piece.style.height = 8 + Math.random() * 12 + 'px';
        piece.style.backgroundColor = getRandomColor();
        piece.style.opacity = Math.random();
        piece.style.top = -Math.random() * 20 + 'px';
        piece.style.transform = 'rotate(' + (Math.random() * 360) + 'deg)';
        piece.style.animationDuration = (2 + Math.random() * 3) + 's';
        confettiContainer.appendChild(piece);
      }
    }
    
    function getRandomColor() {
      const gold = getComputedStyle(document.documentElement).getPropertyValue('--gold').trim() || '#d4af37';
      const colors = [gold, '#e74c3c', '#9b59b6', '#3498db'];
      return colors[Math.floor(Math.random() * colors.length)];
    }
    
    /**********************************
     * Particle Effect (Champion) *
     **********************************/
    function createParticles() {
      const particleContainer = document.getElementById('confettiContainer');
      for (let i = 0; i < 50; i++) {
        const particle = document.createElement('div');
        particle.classList.add('particle');
        particle.style.width = Math.random() * 6 + 4 + 'px';
        particle.style.height = particle.style.width;
        particle.style.left = Math.random() * 100 + '%';
        particle.style.top = Math.random() * 50 + '%';
        particle.style.backgroundColor = getRandomColor();
        particle.style.animationDuration = (3 + Math.random() * 3) + 's';
        particleContainer.appendChild(particle);
      }
      setTimeout(() => { particleContainer.innerHTML = ''; }, 5000);
    }
    
    /**********************************
     * Fireworks Canvas (Champion) *
     **********************************/
    function showFireworks() {
      const canvas = document.getElementById('fireworks');
      canvas.style.display = 'block';
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      let particles = [];
      function Particle(x, y, color) {
        this.x = x; this.y = y;
        this.radius = Math.random() * 3 + 2;
        this.color = color;
        this.speedX = (Math.random() - 0.5) * 8;
        this.speedY = (Math.random() - 0.5) * 8;
        this.alpha = 1;
      }
      Particle.prototype.update = function() {
        this.x += this.speedX;
        this.y += this.speedY;
        this.alpha -= 0.02;
      }
      Particle.prototype.draw = function() {
        ctx.save();
        ctx.globalAlpha = this.alpha;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = this.color;
        ctx.fill();
        ctx.restore();
      }
      function createFirework(x, y) {
        for (let i = 0; i < 100; i++) {
          particles.push(new Particle(x, y, getRandomColor()));
        }
      }
      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles.forEach((p, index) => {
          p.update();
          p.draw();
          if (p.alpha <= 0) particles.splice(index, 1);
        });
        if (particles.length > 0) requestAnimationFrame(animate);
        else canvas.style.display = 'none';
      }
      for (let i = 0; i < 5; i++) {
        setTimeout(() => {
          createFirework(Math.random() * canvas.width, Math.random() * canvas.height / 2);
          animate();
        }, i * 500);
      }
    }
    
    /********************
     * Persistent Leaderboard *
     ********************/
    function saveChampion(winnerRecord) {
      if (!winnerRecord.mode) { winnerRecord.mode = tournament.mode; }
      winnerRecord.timestamp = Date.now();
      let champions = JSON.parse(localStorage.getItem('champions')) || [];
      champions.push(winnerRecord);
      localStorage.setItem('champions', JSON.stringify(champions));
      updatePersistentLeaderboard();
    }
    
    function updatePersistentLeaderboard() {
  let champions = JSON.parse(localStorage.getItem('champions')) || [];
  let groups = {};
  champions.forEach(rec => {
    if (!groups[rec.name]) groups[rec.name] = [];
    groups[rec.name].push(rec);
  });
  let groupedRecords = [];
  for (let name in groups) {
    groups[name].sort((a, b) => b.timestamp - a.timestamp);
    groupedRecords.push({ name: name, count: groups[name].length, records: groups[name] });
  }
  groupedRecords.sort((a, b) => b.count - a.count);
  let currentRank = 0;
  let lastCount = null;
  let medalMap = {};
  groupedRecords.forEach((group, index) => {
    if (lastCount === null || group.count < lastCount) {
      currentRank = index + 1;
      lastCount = group.count;
    }
    if (currentRank === 1) medalMap[group.name] = "ü•á";
    else if (currentRank === 2) medalMap[group.name] = "ü•à";
    else if (currentRank === 3) medalMap[group.name] = "ü•â";
    else medalMap[group.name] = "";
  });
  groupedChampionRecords = groupedRecords;
  let containerLB = document.getElementById('persistentLeaderboardContent');
  if (groupedRecords.length === 0) {
    containerLB.innerHTML = "No champions recorded yet.";
  } else {
    let list = '<ol style="list-style: decimal; padding-left: 20px;">';
    groupedRecords.forEach(group => {
      let medal = medalMap[group.name] ? medalMap[group.name] + " " : "";
      let dates = group.records.map(rec => {
        let dateStr = new Date(rec.timestamp).toLocaleDateString();
        return `<a href="#" onclick="showChampionRecordByName('${group.name}', ${rec.timestamp}); return false;">${dateStr} (${rec.mode})</a> <button onclick="deleteChampionRecord('${group.name}', ${rec.timestamp})">Delete</button>`;
      }).join(", ");
      list += `<li>${medal}${group.name} (Wins: ${group.count}) - ${dates}</li>`;
    });
    list += '</ol>';
    containerLB.innerHTML = list;
  }





}
    function clearLeaderboard() {
      localStorage.removeItem('champions');
      updatePersistentLeaderboard();
      showToast("Global Leaderboard cleared.");
    }
    
    /********************
     * Global Board Navigation *
     ********************/
    function goToGlobalLeaderboard() {
      document.getElementById('tournament').classList.add('hidden');
      document.getElementById('league').classList.add('hidden');
      document.getElementById('championDisplay').classList.add('hidden');
      document.getElementById('setup').classList.remove('hidden');
      document.getElementById('globalLeaderboardSection').scrollIntoView({ behavior: 'smooth' });
  updateSavedTournamentsList();

    }
    
    /********************
     * Return Home *
     ********************/
    function returnHome() {
document.querySelector('meta[name="viewport"]').setAttribute('content', 'width=device-width, initial-scale=1');



 location.reload(); }
    
    /********************
     * Tournament Modal *
     ********************/
    function closeTournamentModal() {
      document.getElementById('tournamentModal').classList.add('hidden');
    }
    
    /********************
     * Feedback Modal *
     ********************/
    function openFeedback() { document.getElementById('feedbackModal').classList.remove('hidden'); }
    function closeFeedback() { document.getElementById('feedbackModal').classList.add('hidden'); }
    document.getElementById('submitFeedback').addEventListener('click', function() {
      const text = document.getElementById('feedbackText').value;
      if (text.trim() === '') { showToast('Please enter your feedback.'); return; }
      showToast('Thank you for your feedback!');
      document.getElementById('feedbackText').value = '';
      closeFeedback();
    });
    


    /**************************
     * Adjust Positions *
     **************************/
    function adjustPositions(container) {
    if (container.id === "leagueSchedule") return; // Skip for league schedule
    if (window.innerWidth <= 768) return; // Skip on mobile
    const rounds = container.getElementsByClassName('bracket-round');
    if (rounds.length < 2) return;
      for (let r = 1; r < rounds.length; r++) {
        const prevRound = rounds[r - 1];
        const currRound = rounds[r];
        const prevMatches = prevRound.getElementsByClassName('match');
        const prevCenters = [];
        const prevRect = prevRound.getBoundingClientRect();
        for (let i = 0; i < prevMatches.length; i++) {
          const rect = prevMatches[i].getBoundingClientRect();
          prevCenters.push(rect.top + rect.height / 2 - prevRect.top);
        }
        const currMatches = currRound.getElementsByClassName('match');
        for (let j = 0; j < currMatches.length; j++) {
          const parentIndex1 = 2 * j;
          const parentIndex2 = 2 * j + 1;
          if (parentIndex2 >= prevCenters.length) continue;
          const desiredCenter = (prevCenters[parentIndex1] + prevCenters[parentIndex2]) / 2;
          const matchHeight = currMatches[j].offsetHeight;
          currMatches[j].style.position = "absolute";
          currMatches[j].style.top = (desiredCenter - matchHeight / 2) + "px";
        }
      }
    }


/*************************************
 * Global Leaderboard Record Viewer
 *************************************/
function showChampionRecordByName(name, timestamp) {
  let champions = JSON.parse(localStorage.getItem('champions')) || [];
  let record = champions.find(rec => rec.name === name && rec.timestamp == timestamp);
  if (!record) {
    showToast("Record not found.");
    return;
  }
  // Hide all primary containers
  document.getElementById('setup').classList.add('hidden');
  document.getElementById('tournament').classList.add('hidden');
  document.getElementById('league').classList.add('hidden');
  document.getElementById('championDisplay').classList.add('hidden');
  
  if(record.mode === 'knockout'){
    // Load Knockout Champion Display
    document.getElementById('championDisplay').classList.remove('hidden');
    
    document.querySelector('input[name="mode"][value="knockout"]').checked = true;
    tournament.mode = "knockout";
    onModeChange();


    // Update (or add) the favicon image in the same position as the trophy.
    // (This assumes you want to use the favicon instead of the trophy for knockout records.)
    const trophyImg = document.querySelector('#championDisplay .trophy');
    if(trophyImg) {
      trophyImg.src = 'assets/icons/favicon.png';
      trophyImg.alt = 'Favicon';
    } else {
      // In case the image element is missing, insert it at the beginning.
      document.getElementById('championDisplay').insertAdjacentHTML('afterbegin', '<img src="assets/icons/favicon.png" alt="Favicon" class="trophy">');
    }
    
    let winner = { name: record.name, photo: record.photo };
    document.getElementById('champion').innerHTML = renderTeam(winner, "final-winner");
    renderChampionBracketFromRecord(record);

  } else if(record.mode === 'league'){
    // Load League View (schedule, table, champion)
    document.getElementById('league').classList.remove('hidden');
    tournament.rounds = record.rounds;
    leagueStandings = record.table;
    tournament.totalTeams = Object.keys(leagueStandings).length;

    document.querySelector('input[name="mode"][value="league"]').checked = true;
    tournament.mode = "league";
    onModeChange();

    renderLeagueSchedule();
    updateLeagueTable();
    let teams = [];
    for(let team in leagueStandings){
      teams.push({ name: team, ...leagueStandings[team] });
    }
    teams.sort((a,b)=> (b.points - a.points) || (b.wins - a.wins));
    let champion = teams[0];
    let finalDiv = document.getElementById('leagueFinal');
    finalDiv.innerHTML = `<h2>League Champion: ${champion.name}</h2>
                          <p>Played: ${champion.played} | Wins: ${champion.wins} | Draws: ${champion.draws} | Losses: ${champion.losses} | Points: ${champion.points}</p>
                          <img src="assets/icons/favicon.png" alt="Favicon" class="trophy">`;
    finalDiv.classList.remove('hidden');
  }
}

function renderChampionBracketFromRecord(record) {
  const championBracket = document.getElementById('championBracket');
  championBracket.innerHTML = '';
  record.rounds.forEach((round, roundIndex) => {
    const roundDiv = document.createElement('div');
    roundDiv.className = 'bracket-round';
    roundDiv.innerHTML = `<h3>${getRoundName(round.matches.length * 2)}</h3>`;
    round.matches.forEach(match => {
      const matchDiv = document.createElement('div');
      matchDiv.className = 'match';
      const teamsContainer = document.createElement('div');
      teamsContainer.className = 'teams';
      const team1Div = document.createElement('div');
      team1Div.innerHTML = renderTeam(match.team1, (match.team1.name === (match.winner ? match.winner.name : '')) ? "final-winner" : "loser");
      const team2Div = document.createElement('div');
      team2Div.innerHTML = renderTeam(match.team2, (match.team2.name === (match.winner ? match.winner.name : '')) ? "final-winner" : "loser");
      const vsText = document.createElement('div');
      vsText.textContent = " vs ";
      vsText.style.margin = "0 5px";
      teamsContainer.appendChild(team1Div);
      teamsContainer.appendChild(vsText);
      teamsContainer.appendChild(team2Div);
      matchDiv.appendChild(teamsContainer);
      if (roundIndex < record.rounds.length - 1) {
        const connectors = document.createElement('div');
        connectors.className = 'connectors';
        connectors.innerHTML = `<div class="connector top"></div><div class="connector bottom"></div>`;
        matchDiv.appendChild(connectors);
      }
      roundDiv.appendChild(matchDiv);
    });
    championBracket.appendChild(roundDiv);
  });
  adjustPositions(championBracket);
}
    
// On page load, update the persistent leaderboard from localStorage
window.addEventListener('load', updatePersistentLeaderboard);


function undoKnockout() {
  if (knockoutHistory.length > 0) {
    let lastState = knockoutHistory.pop();
    if (lastState.type === 'rounds') {
      tournament.rounds = lastState.rounds;
      document.getElementById('tournament').classList.remove('hidden');
      document.getElementById('manualPairingContainer').classList.add('hidden');
      document.getElementById('setup').classList.add('hidden');
      renderBracket();
    } else if (lastState.type === 'manualPairing') {
      manualPairing = lastState.manualPairing;
      document.getElementById('manualPairingContainer').classList.remove('hidden');
      document.getElementById('tournament').classList.add('hidden');
      document.getElementById('setup').classList.add('hidden');
      renderManualPairing();
    } else if (lastState.type === 'setup') {
      restoreTeamInputs(lastState.teams, 'knockout');
      document.getElementById('setup').classList.remove('hidden');
      document.getElementById('tournament').classList.add('hidden');
      document.getElementById('manualPairingContainer').classList.add('hidden');
    }
  } else {
    showToast("No more actions to undo.");
  }
}
function undoLeague() {
  if (leagueHistory.length > 0) {
    let lastState = leagueHistory.pop();
    if (lastState.type === 'league') {
      tournament.rounds = lastState.rounds;
      leagueStandings = lastState.standings;
      renderLeagueSchedule();
      updateLeagueTable();
    } else if (lastState.type === 'setup') {
      restoreTeamInputs(lastState.teams, 'league');
      document.getElementById('league').classList.add('hidden');
      document.getElementById('setup').classList.remove('hidden');
    }
  } else {
    showToast("No more actions to undo.");
  }
}

function saveCurrentState() {
  let state = {
    mode: tournament.mode,
    rounds: JSON.parse(JSON.stringify(tournament.rounds)),
    currentRound: tournament.currentRound,
    totalTeams: tournament.totalTeams,
    leagueStandings: tournament.mode === 'league' ? JSON.parse(JSON.stringify(leagueStandings)) : null
  };
  let savedTournaments = JSON.parse(localStorage.getItem('savedTournaments')) || [];
  let id = Date.now();
  let name = `Tournament - ${tournament.mode} - ${new Date().toLocaleString()}`;
  savedTournaments.push({ id, name, state });
  localStorage.setItem('savedTournaments', JSON.stringify(savedTournaments));
  showToast("Tournament saved.");
}


function updateSavedTournamentsList() {
  let savedTournaments = JSON.parse(localStorage.getItem('savedTournaments')) || [];
  let container = document.getElementById('savedTournamentsList');
  container.innerHTML = '';
  if (savedTournaments.length === 0) {
    container.innerHTML = "No saved tournaments.";
  } else {
    let list = '<ul>';
    savedTournaments.forEach(tournament => {
      list += `<li>${tournament.name} <button onclick="loadSavedTournament(${tournament.id})">Load</button> <button onclick="deleteSavedTournament(${tournament.id})">Delete</button></li>`;
    });
    list += '</ul>';
    container.innerHTML = list;
  }
}

function loadSavedTournament(id) {
  let savedTournaments = JSON.parse(localStorage.getItem('savedTournaments')) || [];
  let tournamentToLoad = savedTournaments.find(t => t.id === id);
  if (!tournamentToLoad) {
    showToast("Tournament not found.");
    return;
  }
  let state = tournamentToLoad.state;
  tournament.mode = state.mode;
  tournament.rounds = state.rounds;
  tournament.currentRound = state.currentRound;
  tournament.totalTeams = state.totalTeams;
  if (state.mode === 'league') {
    leagueStandings = state.leagueStandings;
  }
  knockoutHistory = [];
  leagueHistory = [];
  document.getElementById('setup').classList.add('hidden');
  if (state.mode === 'knockout') {
    document.getElementById('tournament').classList.remove('hidden');
    renderBracket();


  document.querySelector(`input[name="mode"][value="${tournament.mode}"]`).checked = true;
    tournament.mode = "knockout";
    onModeChange();

  } else if (state.mode === 'league') {
    document.getElementById('league').classList.remove('hidden');
    renderLeagueSchedule();
    updateLeagueTable();

  document.querySelector(`input[name="mode"][value="${tournament.mode}"]`).checked = true;
    tournament.mode = "league";
    onModeChange();
  }
}

function deleteSavedTournament(id) {
  if (confirm("Are you sure you want to delete this saved tournament?")) {
    let savedTournaments = JSON.parse(localStorage.getItem('savedTournaments')) || [];
    savedTournaments = savedTournaments.filter(t => t.id !== id);
    localStorage.setItem('savedTournaments', JSON.stringify(savedTournaments));
    updateSavedTournamentsList();
    showToast("Tournament deleted.");
  }
}



function restoreTeamInputs(teams, mode) {
  let container = mode === 'knockout' ? document.getElementById('teamInputs') : document.getElementById('leagueTeamsContainer');
  container.innerHTML = '';
  teams.forEach((team, index) => {
    let div = document.createElement('div');
    div.className = 'team-input';
    let nameInput = document.createElement('input');
    nameInput.type = 'text';
    nameInput.value = team.name;
    div.appendChild(nameInput);
    let photoInput = document.createElement('input');
    photoInput.type = 'file';
    photoInput.accept = 'image/*';
    photoInput.style.cursor = 'pointer';
    if (team.photo) {
      photoInput.dataset.photo = team.photo; // Restore photo data URL
    }
    if (team.icon) {
      photoInput.dataset.icon = team.icon; // Restore icon path
    }
    div.appendChild(photoInput);
    let iconBar = document.createElement('div');
    iconBar.className = 'icon-bar';
    iconOptions.forEach(iconPath => {
      let iconImg = document.createElement('img');
      iconImg.src = iconPath;
      iconImg.className = 'icon-option';
      if (team.icon === iconPath) {
        iconImg.classList.add('selected'); // Highlight previously selected icon
      }
      iconImg.title = 'Select this icon';
      iconImg.addEventListener('click', function() {
        Array.from(iconBar.children).forEach(child => child.classList.remove('selected'));
        iconImg.classList.add('selected');
        photoInput.dataset.icon = iconPath;
      });
      iconBar.appendChild(iconImg);
    });
    div.appendChild(iconBar);
    container.appendChild(div);
  });
  if (mode === 'knockout') {
    document.getElementById('teamCount').value = teams.length;
  } else {
    document.getElementById('leagueTeamCount').value = teams.length;
  }
}function deleteChampionRecord(name, timestamp) {
  if (confirm("Are you sure you want to delete this record?")) {
    let champions = JSON.parse(localStorage.getItem('champions')) || [];
    champions = champions.filter(rec => !(rec.name === name && rec.timestamp === timestamp));
    localStorage.setItem('champions', JSON.stringify(champions));
    updatePersistentLeaderboard();
    showToast("Record deleted.");
  }
}

window.addEventListener('load', () => {
  updatePersistentLeaderboard();
  updateSavedTournamentsList();
});



function renderManualPairing() {
  updateAvailableTeamsUI();
  updateFormedMatchesUI();
  const dropZone1 = document.getElementById('dropZone1');
  const dropZone2 = document.getElementById('dropZone2');
  if (manualPairing.dropSlots[1]) {
    dropZone1.innerHTML = renderTeam(manualPairing.dropSlots[1]);
    dropZone1.classList.add('filled');
  } else {
    dropZone1.innerHTML = "Team Slot 1";
    dropZone1.classList.remove('filled');
  }
  if (manualPairing.dropSlots[2]) {
    dropZone2.innerHTML = renderTeam(manualPairing.dropSlots[2]);
    dropZone2.classList.add('filled');
  } else {
    dropZone2.innerHTML = "Team Slot 2";
    dropZone2.classList.remove('filled');
  }
}



function createIconBar(photoInput) {
  const iconBar = document.createElement('div');
  iconBar.classList.add('icon-bar');
  const icons = [
    "assets/icons/icon1.png",
    "assets/icons/icon2.png",
    "assets/icons/icon3.png",
    "assets/icons/icon4.png",
    "assets/icons/icon5.png",
    "assets/icons/icon6.png",
    "assets/icons/icon7.png",
    "assets/icons/icon8.png"
  ];
  
  icons.forEach(iconSrc => {
    const icon = document.createElement('img');
    icon.src = iconSrc;
    icon.classList.add('icon-option');
    
    icon.addEventListener('click', function() {
      // Toggle deselection if already selected
      if (icon.classList.contains('selected')) {
        icon.classList.remove('selected');
        photoInput.dataset.icon = "";
        // Re-enable photo upload option
        photoInput.disabled = false;
      } else {
        // Deselect any other selected icons in this bar
        const previouslySelected = iconBar.querySelector('.selected');
        if (previouslySelected) {
          previouslySelected.classList.remove('selected');
        }
        icon.classList.add('selected');
        // Set chosen icon and disable photo upload
        photoInput.dataset.icon = iconSrc;
        // Clear any previously uploaded photo
        photoInput.value = "";
        photoInput.dataset.photo = "";
        photoInput.disabled = true;
      }
    });
    
    iconBar.appendChild(icon);
  });
  
  // Monitor file input: if a photo is uploaded, clear icon selection and re-enable icons
  photoInput.addEventListener('change', function() {
    if (photoInput.files && photoInput.files[0]) {
      // Clear icon selection if a photo is chosen
      const selectedIcon = iconBar.querySelector('.selected');
      if (selectedIcon) {
        selectedIcon.classList.remove('selected');
      }
      photoInput.dataset.icon = "";
      // Make sure the input is enabled for photo uploads
      photoInput.disabled = false;
    }
  });
  
  return iconBar;
}






function saveResultAsImage() {
  // Select the element you want to capture, e.g. the tournament bracket or league container
  const element = document.getElementById('tournament') || document.getElementById('league');
  html2canvas(element).then(canvas => {
    // Convert the canvas to an image data URL
    const dataURL = canvas.toDataURL('image/png');
    // Create a temporary link element
    const link = document.createElement('a');
    link.href = dataURL;
    link.download = 'tournament_result.png';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }).catch(error => {
    console.error("Error capturing image:", error);
  });
}


function updateTournamentName() {
  const nameInput = document.getElementById('tournamentNameInput').value.trim();
  if (nameInput) {
    document.getElementById('roundTitle').textContent = nameInput;
    tournament.name = nameInput; // Save it in your tournament object if needed
  } else {
    // If nothing's entered, fallback to a default name
    document.getElementById('roundTitle').textContent = 'Tournament Bracket';
    tournament.name = 'Tournament Bracket';
  }
}






window.addEventListener('DOMContentLoaded', () => {
  // Ensure default mode is Champion (knockout)
  const championModeRadio = document.querySelector('input[name="mode"][value="knockout"]');
  if (championModeRadio) {
    championModeRadio.checked = true;
  }
  tournament.mode = 'knockout'; // Set the default tournament mode
  
  // Call the onModeChange function to update background and sound
  onModeChange();
});


  </script>
</body>
</html>








